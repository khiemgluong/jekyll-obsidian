<body>
    <!-- Your widget content goes here -->
    <div id="fileTree"></div>
    <div id="file-tree">
        <ul>
            {% for item in site.data.obsidian_files_json %}
            <li>{{ item }}</li>
            {% endfor %}
        </ul>
    </div>

</body>

<script lang="ts">
    function buildFileTree(element, tree) {
        const ul = document.createElement('ul');
        element.appendChild(ul);

        tree.forEach(child => {
            const li = document.createElement('li');
            ul.appendChild(li);

            const button = document.createElement('button');
            button.textContent = child.name;
            li.appendChild(button);

            if (child.type === 'dir') {
                var expanded = false;
                button.addEventListener('click', () => {
                    expanded = !expanded;
                    if (expanded) {
                        // Check if the child nodes have already been created
                        if (!li.querySelector('ul')) {
                            buildFileTree(li, child.children);
                        }
                    } else {
                        const nestedUl = li.querySelector('ul');
                        if (nestedUl) {
                            li.removeChild(nestedUl); // Corrected line
                        }
                    }
                });
            } else if (child.type === 'file') {
                button.addEventListener('click', () => {
                    console.log(child.path);
                });
            }
        });
    }

    var obsidianFilesJson = '{{ site.data.obsidian_files_json | escape }}';
    var parsedObsidianFilesJson = JSON.parse(obsidianFilesJson.replace(/&quot;/g, '"'));

    document.addEventListener('DOMContentLoaded', () => {
        const rootElement = document.getElementById('fileTree');
        buildFileTree(rootElement, parsedObsidianFilesJson);
    });


    const fileTreeElement = document.getElementById('fileTree');
    createFileTree(fileTreeElement, tree);

    console.log("Widget loaded!");
</script>

<script lang="text/javascript">

</script>

<style>
    ul {
        list-style-type: none;
        padding-left: 20px;
    }

    ul ul {
        padding-left: 40px;
    }
</style>